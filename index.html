<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pedidos Fondo Creativo</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        margin: 0;
        padding: 20px;
    }

    h1 {
        text-align: center;
        margin-bottom: 25px;
    }

    .contenedor {
        max-width: 1100px;
        margin: auto;
        display: flex;
        flex-direction: column;
        gap: 40px;
    }

    /* ------------------------------------ */
    /* TARJETAS DE PENDIENTES (GRANDES)     */
    /* ------------------------------------ */
    .lista-pendientes {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
        gap: 20px;
    }

    .tarjeta {
        background: white;
        padding: 12px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }

    .tarjeta img {
        width: 380px;
        height: 250px;
        object-fit: cover; /* menos agresivo que antes */
        border-radius: 8px;
    }

    .item {
        width: 100%;
        font-size: 14px;
        line-height: 1.3;
    }

    .titulo {
        font-weight: bold;
        display: inline-block;
        width: 110px;
    }

    .estado {
        padding: 3px 8px;
        border-radius: 6px;
        color: white;
        font-weight: bold;
        font-size: 12px;
    }

    .rojo { background: #d9534f; }
    .amarillo { background: #f0ad4e; }
    .verde { background: #5cb85c; }

    .btn-entregar {
        background: #0275d8;
        color: white;
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 15px;
        margin-top: 5px;
    }

    .btn-entregar:hover { background: #025aa5; }

    /* ------------------------------------ */
    /* TARJETAS DEL HISTORIAL (MINI)        */
    /* ------------------------------------ */
    .lista-historial {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
        gap: 15px;
    }

    .mini-card {
        background: white;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
    }

    .mini-img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 6px;
    }

    .mini-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .mini-label {
        font-weight: bold;
        font-size: 12px;
    }

</style>
</head>

<body>

<h1>Pedidos Fondo Creativo</h1>

<div class="contenedor">

    <!-- PENDIENTES -->
    <section>
        <h2>Pendientes</h2>
        <div id="pendientesLista" class="lista-pendientes"></div>
    </section>

    <!-- HISTORIAL -->
    <section>
        <h2>Historial Entregados</h2>
        <div id="historialLista" class="lista-historial"></div>
    </section>

</div>

<script>
const API_GET = "/.netlify/functions/getPedidos";
const API_UPDATE = "/.netlify/functions/updatePedido";

/* COLORES */
function getColorClase(estado, tipo) {
    if (tipo === "CorreoEnviado") {
        if (estado === "CONFIRMADO") return "verde";
        if (estado === "ENVIADO SIN CONFIRMAR") return "amarillo";
        return "rojo";
    }

    if (tipo === "Sublimado" || tipo === "Costura") {
        if (estado === "TERMINADO") return "verde";
        if (estado === "EN PROCESO") return "amarillo";
        return "rojo";
    }

    if (tipo === "Entrega") {
        if (estado === "ENTREGADO") return "verde";
        if (estado === "MOTORIZADO SOLICITADO" || estado === "EN RUTA") return "amarillo";
        return "rojo";
    }

    return "rojo";
}

/* CARGAR */
async function cargarPedidos() {
    const res = await fetch(API_GET);
    const data = await res.json();

    const pendientes = data.filter(p => p.Entrega !== "ENTREGADO");
    const entregados = data.filter(p => p.Entrega === "ENTREGADO");

    renderPendientes(pendientes);
    renderHistorial(entregados);
}

/* ---------------------- */
/* TARJETAS PENDIENTES    */
/* ---------------------- */
function renderPendientes(lista) {
    const cont = document.getElementById("pendientesLista");
    cont.innerHTML = "";

    lista.forEach(p => {
        const div = document.createElement("div");
        div.className = "tarjeta";

        div.innerHTML = `
            <img src="${p.Imagen}">
            <div class="item"><span class="titulo">Medidas:</span> ${p.Ancho} x ${p.Alto} cm</div>
            <div class="item"><span class="titulo">Fecha:</span> ${p.Fecha}</div>

            <div class="item">
                <span class="titulo">Correo:</span>
                <span class="estado ${getColorClase(p.CorreoEnviado, "CorreoEnviado")}">
                    ${p.CorreoEnviado}
                </span>
            </div>

            <div class="item">
                <span class="titulo">Sublimado:</span>
                <span class="estado ${getColorClase(p.Sublimado, "Sublimado")}">
                    ${p.Sublimado}
                </span>
            </div>

            <div class="item">
                <span class="titulo">Costura:</span>
                <span class="estado ${getColorClase(p.Costura, "Costura")}">
                    ${p.Costura}
                </span>
            </div>

            <div class="item">
                <span class="titulo">Entrega:</span>
                <span class="estado ${getColorClase(p.Entrega, "Entrega")}">
                    ${p.Entrega}
                </span>
            </div>

            <div class="item"><span class="titulo">Nombre:</span> ${p.Nombre}</div>
            <div class="item"><span class="titulo">DNI:</span> ${p.Dni}</div>
            <div class="item"><span class="titulo">Teléfono:</span> ${p.Telefono}</div>
            <div class="item"><span class="titulo">Dirección:</span> ${p.Direccion}</div>
            <div class="item"><span class="titulo">Agencia:</span> ${p.Agencia}</div>

            <div class="item"><span class="titulo">Especificaciones:</span> ${p.Especificaciones}</div>
            <div class="item"><span class="titulo">Observaciones:</span> ${p.Observaciones}</div>
        `;

        const btn = document.createElement("button");
        btn.className = "btn-entregar";
        btn.textContent = "Marcar como ENTREGADO";

        btn.onclick = async () => {
            await marcarEntregado(p.Id);
            cargarPedidos();
        };

        div.appendChild(btn);
        cont.appendChild(div);
    });
}

/* ---------------------- */
/* TARJETAS HISTORIAL     */
/* ---------------------- */
function renderHistorial(lista) {
    const cont = document.getElementById("historialLista");
    cont.innerHTML = "";

    lista.forEach(p => {
        const div = document.createElement("div");
        div.className = "mini-card";

        div.innerHTML = `
            <img src="${p.Imagen}" class="mini-img">
            <div class="mini-info">
                <div><span class="mini-label">Nombre:</span> ${p.Nombre}</div>
                <div><span class="mini-label">Agencia:</span> ${p.Agencia}</div>
                <div><span class="mini-label">Fecha:</span> ${p.FechaEntrega}</div>
                <div><span class="estado verde">ENTREGADO</span></div>
            </div>
        `;

        cont.appendChild(div);
    });
}

/* ---------------------- */
async function marcarEntregado(id) {
    await fetch(`${API_UPDATE}?id=${encodeURIComponent(id)}`);
}

/* ---------------------- */
cargarPedidos();
</script>

</body>
</html>
